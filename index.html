<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Nesne E≈üleme Oyunu - V25</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #79c2ff, #cfe9ff);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #222;
      overflow: hidden;
    }

    .hidden {
      display: none !important;
    }

    /* ---------- MEN√ú EKRANI ---------- */

    #menuScreen {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #ffffffaa, transparent 60%),
                  linear-gradient(135deg, #4ea3ff, #8cd3ff);
    }

    .menu-card {
      background: #ffffffee;
      border-radius: 24px;
      padding: 32px 40px;
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.18);
      max-width: 480px;
      width: 90%;
      text-align: center;
      backdrop-filter: blur(6px);
    }

    .menu-title {
      font-size: 32px;
      font-weight: 800;
      letter-spacing: 1px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: #1c4488;
    }

    .menu-subtitle {
      font-size: 15px;
      margin-bottom: 24px;
      color: #444;
    }

    .mode-button {
      width: 100%;
      padding: 11px 14px;
      margin: 6px 0;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(135deg, #4da3ff, #6cc6ff);
      color: #fff;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.18);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .mode-button span.badge {
      background: rgba(255, 255, 255, 0.22);
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 13px;
    }

    .mode-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
      filter: brightness(1.04);
    }

    .mode-button:active {
      transform: translateY(0px) scale(0.99);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.16);
    }

    .menu-footer {
      margin-top: 16px;
      font-size: 13px;
      color: #355;
    }

    .menu-footer span {
      font-weight: 700;
    }

    /* ---------- OYUN EKRANI ---------- */

    #gameScreen {
      width: 100%;
      height: 100%;
      position: relative;
      padding: 10px 28px 18px 28px;
    }

    /* √ústte men√ºye d√∂n slider + ses butonu */
    #topControls {
      position: absolute;
      top: 10px;
      left: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 10;
    }

    #backSlider {
      flex: 1;
      max-width: 520px;
      height: 34px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 20px;
      position: relative;
      padding: 0 8px;
      display: flex;
      align-items: center;
    }

    #backSliderText {
      font-size: 13px;
      color: #244;
      margin-left: 8px;
      user-select: none;
    }

    #backKnob {
      position: absolute;
      right: 8px; /* saƒüdan sola s√ºr√ºklenecek */
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #3fa2ff);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
      cursor: grab;
    }

    #soundToggle {
      margin-left: 18px;
      padding: 6px 18px;
      border-radius: 999px;
      border: none;
      background: #ffb74d;
      color: #222;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 13px;
    }

    #soundToggle.muted {
      background: #ddd;
      color: #555;
    }

    #soundToggle:hover {
      filter: brightness(1.05);
    }

    /* Y√∂nerge kutusu (sol alt) */

    #instructionBox {
      position: absolute;
      left: 20px;
      bottom: 20px;
      padding: 10px 16px;
      border-radius: 12px;
      border: 2px solid #000;
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(4px);
      min-width: 180px;
    }

    #instructionBox-title {
      font-weight: 800;
      margin-bottom: 4px;
      font-size: 15px;
    }

    #instructionBox ul {
      list-style: none;
      padding-left: 0;
    }

    #instructionBox li {
      font-size: 14px;
      font-weight: 700;
    }

    /* Kart alanlarƒ± */

    #optionsRow {
      position: absolute;
      top: 55px; /* senin sevdiƒüin ayar */
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 32px;
      justify-content: center;
      align-items: flex-start;
      z-index: 2;
    }

    #dragArea {
      position: absolute;
      top: 355px; /* senin sevdiƒüin ayar */
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
    }

    .card {
      width: 150px;
      height: 230px;
      border-radius: 20px;
      background: #fff;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px 10px 14px 10px;
      user-select: none;
      position: relative;
    }

    .card-title {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .card-image {
      flex: 1;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card-image img {
      max-width: 100%;
      max-height: 110px;
      object-fit: contain;
    }

    .card-subtitle {
      font-size: 14px;
      margin-top: 4px;
      color: #444;
    }

    .option-card.correct {
      box-shadow: 0 0 0 3px #28a745, 0 10px 26px rgba(0, 0, 0, 0.25);
    }

    .drag-card.wrong {
      box-shadow: 0 0 0 3px #ff3b30, 0 10px 26px rgba(0, 0, 0, 0.25);
    }

    .drag-card.correct {
      box-shadow: 0 0 0 3px #28a745, 0 10px 26px rgba(0, 0, 0, 0.25);
    }

    .drag-card {
      cursor: grab;
      user-select: none;
      touch-action: none;
    }

    /* Sembol alanlarƒ± */

    #symbolsWrapper {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      z-index: 1;
    }

    #symbolBar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.5);
    }

    #symbolBoard {
      position: absolute;
      right: 40px;
      bottom: 30px;
      width: 340px; /* biraz b√ºy√ºt√ºld√º */
      height: 110px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.5);
      box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.5),
                  0 8px 18px rgba(0, 0, 0, 0.18);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    .symbol-star {
      font-size: 24px;
      transition: transform 0.25s ease, opacity 0.25s ease;
      user-select: none;
    }

    .bar-star {
      color: #ffcc80;
      opacity: 0.4;
    }

    .bar-star.active {
      opacity: 1;
      color: #ffb300;
    }

    .board-star {
      color: #ff9800;
      opacity: 0.2;
      cursor: default;
      font-size: 32px;
    }

    .board-star.filled {
      opacity: 1;
    }

    .board-star.clickable {
      cursor: pointer;
    }

    .floating-star {
      position: fixed;
      font-size: 26px;
      pointer-events: none;
      z-index: 999;
      transition: transform 0.55s ease, opacity 0.55s ease;
    }

    /* K√º√ß√ºk responsive dokunu≈ü */

    @media (max-width: 900px) {
      #optionsRow {
        gap: 18px;
      }
      .card {
        width: 130px;
        height: 210px;
      }
      #symbolBoard {
        right: 16px;
      }
      #instructionBox {
        left: 14px;
        bottom: 16px;
      }
    }
  </style>
</head>
<body>
  <!-- MEN√ú EKRANI -->
  <div id="menuScreen">
    <div class="menu-card">
      <div class="menu-title">
        üéØ NESNE E≈ûLEME OYUNU
      </div>
      <p class="menu-subtitle">Bir e≈üleme modu se√ß ve oyuna ba≈üla!</p>

      <button class="mode-button" data-choices="1">
        1 Se√ßenekli E≈üleme
        <span class="badge">Ba≈ülangƒ±√ß</span>
      </button>
      <button class="mode-button" data-choices="2">
        2 Se√ßenekli E≈üleme
        <span class="badge">Kolay</span>
      </button>
      <button class="mode-button" data-choices="3">
        3 Se√ßenekli E≈üleme
        <span class="badge">Orta</span>
      </button>
      <button class="mode-button" data-choices="4">
        4 Se√ßenekli E≈üleme
        <span class="badge">√ñnerilen</span>
      </button>
      <button class="mode-button" data-choices="5">
        5 Se√ßenekli E≈üleme
        <span class="badge">Zor</span>
      </button>
      <button class="mode-button" data-choices="7">
        7 Se√ßenekli E≈üleme
        <span class="badge">Uzman</span>
      </button>

      <div class="menu-footer">
        <span>Powered by</span> Pika &amp; Berk üåü
      </div>
    </div>
  </div>

  <!-- OYUN EKRANI -->
  <div id="gameScreen" class="hidden">
    <div id="topControls">
      <div id="backSlider">
        <span id="backSliderText">MEN√úYE D√ñNMEK ƒ∞√áƒ∞N S√úR√úKLE ‚Üê</span>
        <div id="backKnob"></div>
      </div>
      <button id="soundToggle">üîä Sesi Kapat</button>
    </div>

    <!-- Y√∂nerge kutusu -->
    <div id="instructionBox">
      <div id="instructionBox-title">Y√ñNERGE :</div>
      <ul>
        <li>- E≈ûLE</li>
        <li>- AYNI OLANI E≈ûLE</li>
      </ul>
    </div>

    <!-- Se√ßenek kartlarƒ± -->
    <div id="optionsRow"></div>

    <!-- S√ºr√ºklenen kart -->
    <div id="dragArea">
      <div id="dragCard" class="card drag-card">
        <div class="card-title" id="dragTitle">ELMA</div>
        <div class="card-image">
          <img id="dragImage" src="" alt="Nesne" />
        </div>
        <div class="card-subtitle" id="dragSubtitle">Apple</div>
      </div>
    </div>

    <!-- Sembol barƒ± + sembol tahtasƒ± -->
    <div id="symbolsWrapper">
      <div id="symbolBar"></div>
    </div>
    <div id="symbolBoard"></div>
  </div>

  <script>
    // ---------------------------
    // VERƒ∞LER (id k√º√ß√ºk harf, TR'siz)
    // ---------------------------

    const items = [
      // Meyveler
      { id: "elma", tr: "ELMA", en: "Apple" },
      { id: "armut", tr: "ARMUT", en: "Pear" },
      { id: "muz", tr: "MUZ", en: "Banana" },
      { id: "uzum", tr: "√úZ√úM", en: "Grapes" },
      { id: "ananas", tr: "ANANAS", en: "Pineapple" },
      { id: "cilek", tr: "√áƒ∞LEK", en: "Strawberry" },
      { id: "karpuz", tr: "KARPUZ", en: "Watermelon" },
      { id: "kavun", tr: "KAVUN", en: "Melon" },
      { id: "portakal", tr: "PORTAKAL", en: "Orange" },
      { id: "kivi", tr: "Kƒ∞Vƒ∞", en: "Kiwi" },

      // Sebzeler
      { id: "domates", tr: "DOMATES", en: "Tomato" },
      { id: "salatalik", tr: "SALATALIK", en: "Cucumber" },
      { id: "biber", tr: "Bƒ∞BER", en: "Pepper" },
      { id: "sarimsak", tr: "SARIMSAK", en: "Garlic" },
      { id: "sogan", tr: "SOƒûAN", en: "Onion" },
      { id: "brokoli", tr: "BROKOLƒ∞", en: "Broccoli" },
      { id: "havuc", tr: "HAVU√á", en: "Carrot" },
      { id: "lahana", tr: "LAHANA", en: "Cabbage" },
      { id: "misir", tr: "MISIR", en: "Corn" },
      { id: "patlican", tr: "PATLICAN", en: "Eggplant" },

      // Ta≈üƒ±tlar
      { id: "araba", tr: "ARABA", en: "Car" },
      { id: "kamyon", tr: "KAMYON", en: "Truck" },
      { id: "motosiklet", tr: "MOTOSƒ∞KLET", en: "Motorcycle" },
      { id: "bisiklet", tr: "Bƒ∞Sƒ∞KLET", en: "Bicycle" },
      { id: "gemi", tr: "GEMƒ∞", en: "Ship" },
      { id: "helikopter", tr: "HELƒ∞KOPTER", en: "Helicopter" },
      { id: "ucak", tr: "U√áAK", en: "Airplane" },
      { id: "tren", tr: "TREN", en: "Train" },
      { id: "otobus", tr: "OTOB√úS", en: "Bus" },
      { id: "itfaiye_araci", tr: "ƒ∞TFAƒ∞YE", en: "Fire Truck" },

      // Hayvanlar
      { id: "aslan", tr: "ASLAN", en: "Lion" },
      { id: "kedi", tr: "KEDƒ∞", en: "Cat" },
      { id: "kopek", tr: "K√ñPEK", en: "Dog" },
      { id: "fil", tr: "Fƒ∞L", en: "Elephant" },
      { id: "kurbaga", tr: "KURBAƒûA", en: "Frog" },
      { id: "yunus", tr: "YUNUS", en: "Dolphin" },
      { id: "kus", tr: "KU≈û", en: "Bird" },
      { id: "ayi", tr: "AYI", en: "Bear" },
      { id: "tavsan", tr: "TAV≈ûAN", en: "Rabbit" },
      { id: "inek", tr: "ƒ∞NEK", en: "Cow" },
      { id: "koyun", tr: "KOYUN", en: "Sheep" },
      { id: "at", tr: "AT", en: "Horse" },
      { id: "kaplumbaga", tr: "KAPLUMBAƒûA", en: "Turtle" },
      { id: "tavuk", tr: "TAVUK", en: "Chicken" },
      { id: "domuz", tr: "DOMUZ", en: "Pig" },
      { id: "ordek", tr: "√ñRDEK", en: "Duck" },
      { id: "balik", tr: "BALIK", en: "Fish" },
      { id: "kaplan", tr: "KAPLAN", en: "Tiger" },
      { id: "maymun", tr: "MAYMUN", en: "Monkey" },
      { id: "keci", tr: "KE√áƒ∞", en: "Goat" }
    ];

    const menuScreen = document.getElementById("menuScreen");
    const gameScreen = document.getElementById("gameScreen");
    const optionsRow = document.getElementById("optionsRow");
    const dragCard = document.getElementById("dragCard");
    const dragTitle = document.getElementById("dragTitle");
    const dragImage = document.getElementById("dragImage");
    const dragSubtitle = document.getElementById("dragSubtitle");
    const symbolBar = document.getElementById("symbolBar");
    const symbolBoard = document.getElementById("symbolBoard");
    const soundToggle = document.getElementById("soundToggle");
    const backKnob = document.getElementById("backKnob");
    const backSlider = document.getElementById("backSlider");

    const MAX_SYMBOLS = 8;
    let currentChoices = 4; // Se√ßilen se√ßenek sayƒ±sƒ± (1,2,3,4,5,7)
    let currentTarget = null;
    let currentOptions = [];
    let canDrag = true;
    let correctCountForItem = 0; // her nesne i√ßin 2 kere doƒüru e≈üleme

    let earnedSymbols = 0;
    let soundEnabled = true;

    // üîä SESLER ‚Äì dosyalarƒ± assets/sounds i√ßine koymalƒ±sƒ±n
    const successVoices = [
      new Audio("assets/sounds/success1.mp3"),
      new Audio("assets/sounds/success2.mp3"),
      new Audio("assets/sounds/success3.mp3"),
      new Audio("assets/sounds/success4.mp3")
    ];

    const countVoices = [
      new Audio("assets/sounds/1.mp3"),
      new Audio("assets/sounds/2.mp3"),
      new Audio("assets/sounds/3.mp3"),
      new Audio("assets/sounds/4.mp3"),
      new Audio("assets/sounds/5.mp3"),
      new Audio("assets/sounds/6.mp3"),
      new Audio("assets/sounds/7.mp3"),
      new Audio("assets/sounds/8.mp3")
    ];

    const allDoneVoice = new Audio("assets/sounds/all_done.mp3");

    function playSound(audio) {
      if (!soundEnabled || !audio) return;
      audio.currentTime = 0;
      audio.play().catch(() => {});
    }

    function updateSoundToggle() {
      if (soundEnabled) {
        soundToggle.classList.remove("muted");
        soundToggle.textContent = "üîä Sesi Kapat";
      } else {
        soundToggle.classList.add("muted");
        soundToggle.textContent = "üîà Sesi A√ß";
      }
    }

    soundToggle.addEventListener("click", () => {
      soundEnabled = !soundEnabled;
      updateSoundToggle();
    });

    // ---------------------------
    // MEN√úDEN MOD SE√áƒ∞Mƒ∞
    // ---------------------------
    document.querySelectorAll(".mode-button").forEach((btn) => {
      btn.addEventListener("click", () => {
        const ch = parseInt(btn.dataset.choices, 10) || 4;
        currentChoices = ch;
        showGameScreen();
      });
    });

    function showGameScreen() {
      menuScreen.classList.add("hidden");
      gameScreen.classList.remove("hidden");
      resetSlider();
      initSymbols();
      earnedSymbols = 0;
      updateSymbols();
      setupNewRound();
    }

    function showMenuScreen() {
      gameScreen.classList.add("hidden");
      menuScreen.classList.remove("hidden");
    }

    // ---------------------------
    // MEN√úYE D√ñN SLIDER
    // ---------------------------

    let isDraggingBack = false;
    let backStartX = 0;
    let knobStartX = 0;

    function resetSlider() {
      const trackWidth = backSlider.clientWidth;
      const knobWidth = backKnob.clientWidth;
      const maxX = trackWidth - knobWidth - 8;
      backKnob.style.left = maxX + "px";
    }

    backKnob.addEventListener("pointerdown", (e) => {
      isDraggingBack = true;
      backKnob.setPointerCapture(e.pointerId);
      const rect = backKnob.getBoundingClientRect();
      backStartX = e.clientX;
      knobStartX = rect.left - backSlider.getBoundingClientRect().left;
    });

    backKnob.addEventListener("pointermove", (e) => {
      if (!isDraggingBack) return;
      const trackWidth = backSlider.clientWidth;
      const knobWidth = backKnob.clientWidth;
      const maxX = trackWidth - knobWidth - 8;
      const minX = 8;
      const dx = e.clientX - backStartX;
      let newX = knobStartX + dx;
      if (newX < minX) newX = minX;
      if (newX > maxX) newX = maxX;
      backKnob.style.left = newX + "px";
    });

    backKnob.addEventListener("pointerup", (e) => {
      if (!isDraggingBack) return;
      isDraggingBack = false;
      backKnob.releasePointerCapture(e.pointerId);
      const knobRect = backKnob.getBoundingClientRect();
      const sliderRect = backSlider.getBoundingClientRect();
      const offsetX = knobRect.left - sliderRect.left;

      // Saƒüdan sola √ßekildi, sola iyice geldiyse men√ºye d√∂n
      if (offsetX < 20) {
        showMenuScreen();
      } else {
        resetSlider();
      }
    });

    // ---------------------------
    // SEMBOLLER
    // ---------------------------
    let barStars = [];
    let boardStars = [];
    let countingMode = false;
    let countingIndex = 0;

    function initSymbols() {
      symbolBar.innerHTML = "";
      symbolBoard.innerHTML = "";
      barStars = [];
      boardStars = [];
      for (let i = 0; i < MAX_SYMBOLS; i++) {
        const barStar = document.createElement("span");
        barStar.className = "symbol-star bar-star active";
        barStar.textContent = "‚≠ê";
        symbolBar.appendChild(barStar);
        barStars.push(barStar);

        const boardStar = document.createElement("span");
        boardStar.className = "symbol-star board-star";
        boardStar.textContent = "‚≠ê";
        symbolBoard.appendChild(boardStar);
        boardStars.push(boardStar);
      }
      countingMode = false;
      countingIndex = 0;
    }

    function updateSymbols() {
      // bar tarafƒ±: kazanƒ±lmamƒ±≈ü yƒ±ldƒ±zlar
      barStars.forEach((star, index) => {
        if (index < MAX_SYMBOLS - earnedSymbols) {
          star.classList.add("active");
        } else {
          star.classList.remove("active");
        }
      });

      // board tarafƒ±: kazanƒ±lmƒ±≈ü yƒ±ldƒ±zlar
      boardStars.forEach((star, index) => {
        if (index < earnedSymbols) {
          star.classList.add("filled");
        } else {
          star.classList.remove("filled");
        }
        star.classList.remove("clickable");
      });

      if (earnedSymbols >= MAX_SYMBOLS) {
        enableCountingMode();
      }
    }

    function animateSymbolTransfer() {
      // bar merkezinden board merkezine u√ßan yƒ±ldƒ±z
      const barRect = symbolBar.getBoundingClientRect();
      const boardRect = symbolBoard.getBoundingClientRect();
      const startX = barRect.left + barRect.width / 2;
      const startY = barRect.top + barRect.height / 2;
      const endX = boardRect.left + boardRect.width / 2;
      const endY = boardRect.top + boardRect.height / 2;

      const star = document.createElement("div");
      star.className = "floating-star";
      star.textContent = "‚≠ê";
      star.style.left = startX + "px";
      star.style.top = startY + "px";
      document.body.appendChild(star);

      requestAnimationFrame(() => {
        const dx = endX - startX;
        const dy = endY - startY;
        star.style.transform = `translate(${dx}px, ${dy}px)`;
        star.style.opacity = "0";
      });

      setTimeout(() => {
        document.body.removeChild(star);
        updateSymbols();
      }, 600);
    }

    function enableCountingMode() {
      countingMode = true;
      countingIndex = 0;
      boardStars.forEach((star, index) => {
        star.classList.add("clickable");
        star.onclick = () => {
          if (!countingMode) return;
          if (index !== countingIndex) return;

          if (countingIndex < countVoices.length) {
            playSound(countVoices[countingIndex]);
          }

          boardStars[index].classList.remove("filled");
          barStars[MAX_SYMBOLS - 1 - countingIndex].classList.add("active");

          countingIndex++;
          if (countingIndex >= MAX_SYMBOLS) {
            countingMode = false;
            earnedSymbols = 0;
            playSound(allDoneVoice);
            setTimeout(() => {
              initSymbols();
            }, 700);
          }
        };
      });
    }

    // ---------------------------
    // OYUN MANTIƒûI
    // ---------------------------

    function randomItem() {
      return items[Math.floor(Math.random() * items.length)];
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function setupNewRound() {
      canDrag = true;
      dragCard.classList.remove("correct", "wrong");
      correctCountForItem = 0; // yeni nesne i√ßin sƒ±fƒ±rla

      // Hedef nesne
      currentTarget = randomItem();
      // Se√ßenekler
      setupOptionsForSameItem(true);
      // Drag kartƒ± hedef nesne
      dragTitle.textContent = currentTarget.tr;
      dragSubtitle.textContent = currentTarget.en;
      dragImage.src = `assets/${currentTarget.id}.png`;
      dragImage.alt = currentTarget.tr;

      resetDragPosition(true);
    }

    function setupOptionsForSameItem(firstTime = false) {
      const others = shuffle(
        items.filter((x) => x.id !== currentTarget.id)
      ).slice(0, Math.max(currentChoices - 1, 0));

      currentOptions = shuffle([currentTarget, ...others]).slice(
        0,
        currentChoices
      );

      optionsRow.innerHTML = "";
      currentOptions.forEach((item) => {
        const card = document.createElement("div");
        card.className = "card option-card";
        card.dataset.id = item.id;

        const titleDiv = document.createElement("div");
        titleDiv.className = "card-title";
        titleDiv.textContent = item.tr;

        const imageDiv = document.createElement("div");
        imageDiv.className = "card-image";
        const img = document.createElement("img");
        img.src = `assets/${item.id}.png`;
        img.alt = item.tr;
        imageDiv.appendChild(img);

        const subDiv = document.createElement("div");
        subDiv.className = "card-subtitle";
        subDiv.textContent = item.en;

        card.appendChild(titleDiv);
        card.appendChild(imageDiv);
        card.appendChild(subDiv);

        optionsRow.appendChild(card);
      });

      if (!firstTime) {
        resetDragPosition(true);
        dragCard.classList.remove("correct", "wrong");
      }
    }

    // ---------------------------
    // DRAG & DROP (FINAL S√úR√úM)
    // ---------------------------

    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let startPosX = 0;
    let startPosY = 0;
    let dragPosX = 0;
    let dragPosY = 0;
    let activePointerId = null;

    function resetDragPosition(immediate = false) {
      const duration = immediate ? "0s" : "0.25s";
      dragPosX = 0;
      dragPosY = 0;
      dragCard.style.transition = `transform ${duration}`;
      dragCard.style.transform = "translate(0px, 0px)";
    }

    dragCard.addEventListener("pointerdown", (e) => {
      if (!canDrag) return;

      isDragging = true;
      activePointerId = e.pointerId;
      dragCard.setPointerCapture(activePointerId);

      dragCard.style.transition = "none";
      dragCard.style.cursor = "grabbing";

      dragStartX = e.clientX;
      dragStartY = e.clientY;
      startPosX = dragPosX;
      startPosY = dragPosY;
    });

    dragCard.addEventListener("pointermove", (e) => {
      if (!isDragging || e.pointerId !== activePointerId) return;

      const dx = e.clientX - dragStartX;
      const dy = e.clientY - dragStartY;

      dragPosX = startPosX + dx;
      dragPosY = startPosY + dy;

      dragCard.style.transform = `translate(${dragPosX}px, ${dragPosY}px)`;
    });

    dragCard.addEventListener("pointerup", (e) => {
      if (!isDragging || e.pointerId !== activePointerId) return;

      isDragging = false;
      dragCard.releasePointerCapture(activePointerId);
      dragCard.style.cursor = "grab";

      handleDrop();
    });

    dragCard.addEventListener("pointercancel", () => {
      isDragging = false;
      dragCard.style.cursor = "grab";
      resetDragPosition(true);
    });

    // ---------------------------
    // DROP KONTROL√ú
    // ---------------------------

    function handleDrop() {
      const dragRect = dragCard.getBoundingClientRect();
      const optionCards = Array.from(
        document.querySelectorAll(".option-card")
      );
      let hitCard = null;
      let hitItem = null;

      for (let i = 0; i < optionCards.length; i++) {
        const card = optionCards[i];
        const rect = card.getBoundingClientRect();
        const overlap =
          dragRect.right > rect.left &&
          dragRect.left < rect.right &&
          dragRect.bottom > rect.top &&
          dragRect.top < rect.bottom;
        if (overlap) {
          hitCard = card;
          hitItem = currentOptions[i];
          break;
        }
      }

      if (!hitCard || !hitItem) {
        showWrongFeedback();
        return;
      }

      if (hitItem.id === currentTarget.id) {
        showCorrectFeedback(hitCard);
      } else {
        showWrongFeedback();
      }
    }

    function showWrongFeedback() {
      dragCard.classList.add("wrong");
      canDrag = false;
      setTimeout(() => {
        dragCard.classList.remove("wrong");
        resetDragPosition(false);
        setTimeout(() => {
          canDrag = true;
        }, 260);
      }, 260);
    }

    function showCorrectFeedback(targetCard) {
      canDrag = false;
      dragCard.classList.add("correct");
      targetCard.classList.add("correct");

      const dragRect = dragCard.getBoundingClientRect();
      const targetRect = targetCard.getBoundingClientRect();
      const dx =
        targetRect.left +
        targetRect.width / 2 -
        (dragRect.left + dragRect.width / 2);
      const dy =
        targetRect.top +
        targetRect.height / 2 -
        (dragRect.top + dragRect.height / 2);

      dragCard.style.transition = "transform 0.35s ease";
      dragCard.style.transform = `translate(${dragPosX + dx}px, ${dragPosY + dy}px)`;

      // Sembol kazanma
      if (earnedSymbols < MAX_SYMBOLS) {
        earnedSymbols++;
        animateSymbolTransfer();
        const voice =
          successVoices[
            Math.floor(Math.random() * successVoices.length)
          ];
        playSound(voice);
      }

      setTimeout(() => {
        targetCard.classList.remove("correct");
        dragCard.classList.remove("correct");
        resetDragPosition(true);

        // Aynƒ± nesne 2 kere doƒüru e≈ülensin
        correctCountForItem++;
        if (correctCountForItem < 2) {
          setupOptionsForSameItem(false);
          canDrag = true;
        } else {
          setTimeout(() => {
            setupNewRound();
          }, 80);
        }
      }, 650);
    }

    // ---------------------------
    // BA≈ûLANGI√á
    // ---------------------------

    updateSoundToggle();
    // Ba≈üta men√º g√∂r√ºnecek, oyuna girince setupNewRound √ßaƒürƒ±lacak
document.body.addEventListener("click", () => {
  console.log("BODY TIKLANDI");
});

  </script>
</body>
</html>
